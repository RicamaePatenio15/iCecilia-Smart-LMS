{% extends 'base.html' %}
{% set active='students' %}
{% block content %}
<h1>Students</h1>
<div class="card">
  <form method="post" action="{{ url_for('students') }}">
    <div class="row-3">
      <div><label>First name</label><input name="first_name" required></div>
      <div><label>Last name</label><input name="last_name"></div>
      <div><label>Year Level</label><select name="year_level"><option>1</option><option>2</option><option>3</option><option>4</option></select></div>
      <div><label>Contact #</label><input name="contact_no"></div>
      <div><label>RFID / FID Code</label><input name="fid_code" required placeholder="RF-XXXX"></div>
      <div><label>Status</label><select name="status"><option>active</option><option>inactive</option></select></div>
    </div>
    <div style="margin-top:10px"><button class="btn">Add Student</button></div>
  </form>
</div>

<div style="display:flex; align-items:center; justify-content:space-between; margin-top:18px;">
  <h2 style="margin:0; font-size:28px; font-weight:700; color:var(--maroon-dark)">All Students</h2>
 
</div>
 <form id="filterForm" method="get" action="{{ url_for('students') }}" style="display:flex; align-items:center; gap:10px;">
    <label class="small" for="statusFilter" style="margin:0 8px 0 0;">Filter by status:</label>
    <select name="status_filter" id="statusFilter" class="styled-select" style="min-width:160px;">
      <option value="all" {% if status_filter=='all' %}selected{% endif %}>All</option>
      <option value="active" {% if status_filter=='active' %}selected{% endif %}>Active</option>
      <option value="inactive" {% if status_filter=='inactive' %}selected{% endif %}>Inactive</option>
    </select>
  </form>

<div class="card" style="margin-top:12px">
  <table class="table table-students">
    <thead>
      <tr>
        <th>FID</th>
        <th>Name</th>
        <th style="width:120px;text-align:center">Year</th>
        <th style="width:120px;text-align:center">Status</th>
        <th style="width:220px;text-align:center">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for s in students %}
      <tr>
        <td>{{ s['fid_code'] }}</td>
        <td>{{ s['first_name'] }} {{ s['last_name'] or '' }}</td>
        <td style="text-align:center">{{ s['year_level'] or '' }}</td>
        <td style="text-align:center">
          <span class="badge {% if s['status'] == 'active' %}ok{% endif %}">
            {{ s['status'] }}
          </span>
        </td>
        <td style="text-align:center">
          <a class="btn btn-sm" href="{{ url_for('student_edit', student_id=s['student_id']) }}" style="margin-right:8px">Edit</a>
          {% if s['status'] == 'active' %}
            <form method="post" action="{{ url_for('student_deactivate', student_id=s['student_id']) }}" style="display:inline-block; margin:0;">
              <button class="btn secondary btn-sm" type="submit" style="margin:0;">Deactivate</button>
            </form>
          {% else %}
            <form method="post" action="{{ url_for('student_restore', student_id=s['student_id']) }}" style="display:inline-block; margin:0;">
              <button class="btn btn-sm" type="submit" style="margin:0;">Restore</button>
            </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
      {% if not students %}
      <tr>
        <td colspan="5" style="text-align:center; padding:20px; color:var(--gray);">
          No students found.
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const statusFilter = document.getElementById('statusFilter');
    if (statusFilter) {
      statusFilter.addEventListener('change', function() {
        document.getElementById('filterForm').submit();
      });
    }
  });
</script>
{% endblock %}